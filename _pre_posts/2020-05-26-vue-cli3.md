---
layout: post
title: 'vue-cli webpack 配置信息分析（optimization 及 plugins）'
date: '2020-06-30'
author: 'XuBaoshi'
header-img: 'img/node-module.jpg'
---

# vue-cli webpack 配置信息分析（optimization 及 plugins）

## 使用 vue-cli3 生成 webpack 配置（default）

![/img/vue-cli/1.png](/img/vue-cli/1.png)

项目生成和完毕后，切换到项目目录，执行命令 `npx vue-cli-service inspect`, 生成的 webpack 信息如下：

[webpack 配置信息](/img/vue-cli/config.js)

## optimization

## webpack 中 module、chunk、bundle 的概念

1. module webpack 支持 commonJS、ES6 等模块化规范
2. chunk chunk 是 webpack 根据功能拆分出来的，包含三种情况： 1. 项目入口文件 2. 动态引入的代码 `import (*.js)` 3. webpack splitChunks 拆分出来的代码，chunk 中包含 module 可能是一对一也可能是一对多
3. bundle 是 webpack 打包后的各个文件， 一般与 chunk 是一对一的关系

### splitChunks

#### splitChunks 的作用

- 抽离相同的代码到一个共享块
- 脚本懒加载，使得初始下载的代码更小

在 webpack4 之前废弃的通常使用的是 CommonsChunkPlugin 作为拆分

### CommonsChunkPlugin 弊端

// todo

由于 webpack4 是开箱即用的，在没有配置情况下（没有 webpack.config.js）optimization.splitChunks 配置如下：

```javascript
module.exports = {
  //...
  optimization: {
    splitChunks: {
      chunks: 'async',
      minSize: 30000,
      minChunks: 1,
      maxAsyncRequests: 5,
      maxInitialRequests: 3,
      automaticNameDelimiter: '~',
      name: true,
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          priority: -10,
        },
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true,
        },
      },
    },
  },
}
```

### splitChunks.chunks

chunks 选项有 async、initial、all

- async 表示只从异步加载的模块进行拆分
- initial 表示只从入口模块进行拆分
- all 两者以上

有以下需要注意的是 `splitChunks.chunks` 设置的是一个默认的范围，cacheGroups 中的每一可以单独配置，覆盖默认的配置。  
cacheGroups 之外设置的约束条件比如说默认配置里面的 chunks、minSize、minChunks 等等都会作用于 cacheGroups，除了 test, priority and reuseExistingChunk。

### splitChunks.minSize

被分割文件(没有被压缩前的体积)是否大于 splitChunks.minSize

### splitChunks.minChunks

被分割文件为被引用的数量大于或等于 splitChunks.minChunks， cacheGroups 内的约束条件可以单独设置

## plugins
